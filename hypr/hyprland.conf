# by XNZF
# we Wayland already
# mom's spaghetti
# v0.50.1

# monitors
# monitor = HDMI-A-2, 2560x1440@144, 0x0, 1, bitdepth, 10, cm, auto

monitorv2 {
  output = HDMI-A-2
  mode = 2560x1440@144
  position = 0x0
  scale = 1

  bitdepth = 10
  #cm = srgb

  supports_wide_color = 1
  supports_hdr = 1
  sdrbrightness = 1.02
  sdrsaturation = 0.96
  sdr_min_luminance = 0.005
  sdr_max_luminance = 309
}

monitor = DP-3, 1920x1200@60, 2560x0, 1, transform, 1
# -- laptop
# monitor = eDP-1, 1920x1080@60, 0x0, 1

# execute at launch
exec-once = $HOME/.config/hypr/scripts/autostart

# plugins
# exec-once = hyprpm reload -n
# plugin = /usr/lib/libhy3.so
# -- source
# source = ~/.config/hypr/modules/plugins.conf


# env vars
# - cursor
env = HYPRCURSOR_THEME,catppuccin-mocha-lavender
env = HYPRCURSOR_SIZE,24
env = XCURSOR_THEME,catppuccin-mocha-lavender
env = XCURSOR_SIZE,24

# - theme
env = QT_QPA_PLATFORMTHEME,hyprqt6engine
env = GTK_THEME,Sweet:dark

# - platform vars
env = QT_AUTO_SCREEN_SCALE_FACTOR,1
env = QT_QPA_PLATFORM,wayland;xcb
env = QT_SCALE_FACTOR,1
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_DESKTOP,Hyprland
env = XDG_DATA_HOME,/home/xnzf/
env = XDG_CONFIG_HOME,/home/xnzf/.config/
env = XDG_CACHE_HOME,/home/xnzf/.cache/
env = ELECTRON_OZONE_PLATFORM_HINT,wayland

# - wine/proton
env = VK_ICD_FILENAMES,/usr/share/vulkan/icd.d/nvidia_icd.json
env = PROTON_ENABLE_WAYLAND,1
env = PROTON_USE_NTSYNC,1
#env = PROTON_USE_WINED3D,1
env = DXVK_FRAME_RATE,144
env = VKD3D_FRAME_RATE,144
# env = ENABLE_HDR_WSI,1
# env = VKD3D_HDR,1
#env = VKD3D_CONFIG, dxr # force_static_cbv # nvidia only

# - nvidia
env = LIBVA_DRIVER_NAME,nvidia
env = PROTON_ENABLE_NVAPI,1
env = XDG_SESSION_TYPE,wayland
env = GBM_BACKEND,nvidia-drm
env = NVD_BACKEND,direct
env = __GLX__VENDOR_LIBRARY_NAME,nvidia
env = __GL_THREADED_OPTIMIZATION,1
env = __GL_SHADER_DISK_CACHE,1
env = __GL_SHADER_DISK_CACHE_PATH,/home/xnzf/.cache/nvidia/GLCache/

# - amd
# env = AMD_VULKAN_ICD,radv


# - screenshots
env = SLURP_ARGS, -d -B F050F022 -b 10101022 -c ff00ff
env = GRIMBLAST_EDITOR, swappy
env = HYPRSHOT_DIR, /home/xnzf/Pictures/screenshots/
env = XDG_PICTURES_DIR, /home/xnzf/Pictures/screenshots/

# baseline
general {
  border_size = 1
  no_border_on_floating = true
  gaps_in = 8
  gaps_out = 15
  col.active_border = rgba(89b4fa00) rgba(89b4fa00) rgba(ff225bdf) rgba(89b4fa00) rgba(89b4fa00) rgba(4e44ffd0) rgba(89b4fa00) rgba(89b4fa00) 75deg
  col.inactive_border = rgba(89b4fa00) rgba(89b4fa00) rgba(ff668d59) rgba(89b4fa00) rgba(89b4fa00) rgba(8e88ff9a) rgba(89b4fa00) rgba(89b4fa00) 75deg
  # col.inactive_border=0xff45475a 0xff45475a 0xff454700 -75deg

  # col.active_border = rgb(4a7bff) rgb(56bbf1) rgb(00dfa2) 45deg
  # col.inactive_border = rgb(4a7bff) rgb(56bbf1) rgb(00dfa2) -45deg

  layout = dwindle

  # -- fullscreen apps
  allow_tearing = true
  no_focus_fallback = true

  snap {
    enabled = false
    window_gap = 8
    monitor_gap = 15
    respect_gaps = true
  }
}

decoration {
  rounding = 15
  rounding_power = 3.3

  active_opacity = 1.0
  inactive_opacity = 0.75
  fullscreen_opacity = 1.0

  dim_modal = false
  dim_inactive = true
  dim_strength = 0.15
  dim_special = 0.3

  border_part_of_window = true

  blur {
    enabled = true
    size = 6
    passes = 3
    ignore_opacity = true
    new_optimizations = true
    xray = true
    noise = 0.0117
    contrast = 1.6816
    brightness = 0.8172
    vibrancy = 0.9126
    vibrancy_darkness = 0.1696
    input_methods = true
    input_methods_ignorealpha = 0.2
  }
  shadow {
    enabled = true
    range = 3
    render_power = 3
    ignore_window = false
    color = rgba(7233de42)
    color_inactive = rgba(5421bf21)
    # offset = 0.5 40
  }
}

animations {
  enabled = true
  workspace_wraparound = true

  # animation definitions
  bezier = expOutOvershot, -0.15, 1.15, -0.05, 1.05
  bezier = expOut, 0.05, 0.95, 0.035, 1.05
  bezier = overshot, 0.13, 0.99, 0.29, 1.1

  # window bobbing
  animation = windows, 1, 4, overshot, slide
  animation = workspaces, 1, 6, overshot, slide

  # border spin
  animation = border, 1, 0.6, default
  animation = borderangle, 1, 60, default
  animation = fade, 1, 10, default
}

input {
  kb_model =
  kb_layout = us,ua,us
  kb_variant = ,,dvorak
  kb_options = grp:alt_shift_toggle
  kb_rules =
  resolve_binds_by_sym = false
  sensitivity = 0 # -1.0 - 1.0, 0 means no modification.
  accel_profile = adaptive

  follow_mouse = 1
  mouse_refocus = false
  float_switch_override_focus = 2

  touchpad {
    natural_scroll = false
  }

  touchdevice {
    output = HDMI-A-2
  }

  virtualkeyboard {
    release_pressed_on_close = true
  }

  tablet {
    output = HDMI-A-2
  }
# Example per-device config
# See https://wiki.hyprland.org/Configuring/Keywords/#executing for more
# device:epic-mouse-v1 {
#    sensitivity = -0.5
# }
}

gestures {
}

group {
  # col.active_border= rgba(89b4fa00) rgba(89b4fa00) rgba(2e22ffdf) rgba(89b4fa00) rgba(89b4fa00) rgba(ACFBF3d0) rgba(89b4fa00) rgba(89b4fa00) 75deg
  # col.inactive_border= rgba(89b4fa00) rgba(89b4fa00) rgba(8e88ff59) rgba(89b4fa00) rgba(89b4fa00) rgba(ff00429a) rgba(89b4fa00) rgba(89b4fa00) 75deg
  # col.border_active = rgba(f4af3300) rgba(f4af3300) rgba(15fb33df) rgba(89b4fa00) rgba(89b4fa00) rgba(1afcaad0) rgba(89b4fa00) rgba(89b4fa00) 75deg
  # col.border_inactive = rgba(89b4fa00) rgba(89b4fa00) rgba(ff06b559) rgba(89b4fa00) rgba(89b4fa00) rgba(ff00429a) rgba(89b4fa00) rgba(89b4fa00) 75deg
  # col.border_locked_active =  rgba(f4af3300) rgba(f4af3300) rgba(f4af33df) rgba(89b4fa00) rgba(89b4fa00) rgba(fff333d0) rgba(89b4fa00) rgba(89b4fa00) 75deg
  # col.border_locked_inactive = rgba(89b4fa00) rgba(89b4fa00) rgba(ff06b559) rgba(89b4fa00) rgba(89b4fa00) rgba(ff00429a) rgba(89b4fa00) rgba(89b4fa00) 75deg
  groupbar {
    # font_family = Hack Nerd Font
    # font_size = 9
    # height = 15
    # text_color = rgba(fffa33ff)
    # col.active = rgba(15ab33a1) rgba(1afcaaad) 30deg
    # col.inactive = rgba(ff06b559) rgba(ff00429a)
    # col.locked_active = rgba(f4af33df) rgba(ff00429a) 30deg
    # col.locked_inactive = rgba(ff06b559) rgba(ff00429a)
  }
}

misc {
  disable_splash_rendering = true
  font_family = Hack Nerd Font
  force_default_wallpaper = -1
  vrr = 2
  layers_hog_keyboard_focus = true
  animate_manual_resizes = true
  animate_mouse_windowdragging = true
  enable_swallow = false
  focus_on_activate = true
  anr_missed_pings = 3
}

binds {
  hide_special_on_workspace_change = true
  workspace_center_on = 1
}

xwayland {
  use_nearest_neighbor = false
  force_zero_scaling = true
  create_abstract_socket = false
}

opengl {
  nvidia_anti_flicker = false
}

render {
  direct_scanout = true
  cm_fs_passthrough = 2 # 1 - always, 2 - hdr only
  cm_enabled = true
  send_content_type = true
  cm_auto_hdr = 2 # 1 - cm = hdr, 2 - cm = hdredid
  new_render_scheduling = true
}

cursor {
  no_hardware_cursors = 2 # tearing only
  no_break_fs_vrr = 1
  persistent_warps = true
  default_monitor = HDMI-A-2
  warp_on_change_workspace = true
  enable_hyprcursor = true
  use_cpu_buffer = 2 # nvidia only
}

experimental {
  xx_color_management_v4 = true
}

debug {
  disable_logs = false
  disable_time = false
  damage_blink = false
  enable_stdout_logs = true
  colored_stdout_logs = false
  full_cm_proto = true
}

dwindle {
    # See https://wiki.hyprland.org/Configuring/Dwindle-Layout/ for more
    pseudotile = yes # master switch for pseudotiling. Enabling is bound to mainMod + P in the keybinds section below
    preserve_split = yes # you probably want this
}

master {
    # See https://wiki.hyprland.org/Configuring/Master-Layout/ for more
    new_status = master
    orientation = left
}

# GLOB
# -- variable/tag setting
windowrule = tag +decor, class:^(.*showmethekey)$
windowrule = tag +decor, class:^(showmethekey.*)$

windowrule = tag +util, class:^(showmethekey.*)$
windowrule = tag +util, class:^(.*pavucontrol)$
windowrule = tag +util, class:^(thunar)$

windowrule = tag +pop, class:^(.*pavucontrol)$
windowrule = tag +pop, class:^(thunar)$

windowrule = tag +web, class:^(firefox*?)$
windowrule = tag +web, class:^(zen-.*)$

windowrule = tag +important, class:^(zen-.*)$
windowrule = tag +important, class:^(kitty)$

# -- rule setting
windowrule = size 35% 35%, tag:pop
windowrule = center 1, tag:pop

windowrule = persistentsize, tag:decor
windowrule = pin, tag:decor
windowrule = nofollowmouse, tag:decor
windowrule = noinitialfocus, tag:decor

windowrule = float, tag:util

windowrule = opaque, tag:important
windowrule = nodim, tag:important

# -- LAYER
layerrule = blur,notifications
layerrule = ignorezero,notifications
layerrule = blur,quickshell
layerrule = blurpopups,quickshell
layerrule = ignorezero,quickshell
# -- Caelestia Layer rules
layerrule = animation fade, hyprpicker  # Colour picker out animation
layerrule = animation fade, logout_dialog  # wlogout
layerrule = animation fade, selection  # slurp
layerrule = animation fade, wayfreeze

# Fuzzel
layerrule = animation popin 80%, launcher
layerrule = blur, launcher

# Shell
layerrule = noanim, caelestia-(border-exclusion|area-picker)
layerrule = animation fade, caelestia-(drawers|background)

layerrule = blur, caelestia-drawers
layerrule = ignorealpha 0.57, caelestia-drawers

# Special workspaces
windowrule = workspace special:sysmon, class:btop
windowrule = workspace special:music, class:feishin|Spotify|Supersonic
windowrule = workspace special:music, initialTitle:Spotify( Free)?  # Spotify wayland, it has no class for some reason
windowrule = workspace special:communication, class:discord|equibop|vesktop|whatsapp
windowrule = workspace special:todo, class:Todoist

# Dialogs
windowrule = float, title:(Select|Open)( a)? (File|Folder)(s)?
windowrule = float, title:File (Operation|Upload)( Progress)?
windowrule = float, title:.* Properties
windowrule = float, title:Export Image as PNG
windowrule = float, title:GIMP Crash Debug
windowrule = float, title:Save As
windowrule = float, title:Library
# Picture in picture (resize and move done via script)
windowrule = move 100%-w-2% 100%-w-3%, title:Picture(-| )in(-| )[Pp]icture  # Initial move so window doesn't shoot across the screen from the center
windowrule = keepaspectratio, title:Picture(-| )in(-| )[Pp]icture
windowrule = float, title:Picture(-| )in(-| )[Pp]icture
windowrule = pin, title:Picture(-| )in(-| )[Pp]icture

# GAMES
# -- native
windowrule = content game, class:^(factorio)$

# -- proton
windowrule = content game, class:^(steam_app_.*)$

# -- rules
windowrule = immediate, content:game
windowrule = norounding, content:game
windowrule = noanim, content:game
windowrule = noborder, content:game
windowrule = noshadow, content:game
windowrule = forcergbx, content:game
windowrule = focusonactivate, content:game


# UTILS
# -- term
windowrule = size 597>600 60>63, class:^(showmethekey.*)$
windowrule = monitor HDMI-A-2, class:^(showmethekey.*)$
windowrule = move onscreen 100%-w-60 1320, class:^(showmethekey.*)$
windowrule = decorate, class:^(showmethekey.*)$

# -- image
windowrule = opaque, class:^(imv.*)$

# -- video

# -- browser
windowrule = focusonactivate, class:^(zen-.*)$

# BINDS
$mainMod = SUPER
# default programs
$terminal = kitty
$fileManager = thunar
$menu = caelestia:launcher

exec = hyprctl dispatch submap global
submap = global

# bind = CTRL, C, exec, wl-copy
# bind = CTRL, V, exec, wl-paste
bind = $mainMod, R, global, $menu
bindin = Super, catchall, global, caelestia:launcherInterrupt
bindin = Super, mouse:272, global, caelestia:launcherInterrupt
bindin = Super, mouse:273, global, caelestia:launcherInterrupt
bindin = Super, mouse:274, global, caelestia:launcherInterrupt
bindin = Super, mouse:275, global, caelestia:launcherInterrupt
bindin = Super, mouse:276, global, caelestia:launcherInterrupt
bindin = Super, mouse:277, global, caelestia:launcherInterrupt
bindin = Super, mouse_up, global, caelestia:launcherInterrupt
bindin = Super, mouse_down, global, caelestia:launcherInterrupt
bind = $mainMod, T, exec, $terminal
bind = $mainMod, C, killactive,
# bind = $mainMod SHIFT, C, hy3:killactive,
# bind = $mainMod, M, exit,
bind = $mainMod, E, exec, $fileManager
bind = $mainMod, V, togglefloating,
bind = $mainMod, P, pseudo, # dwindle
bind = $mainMod, J, togglesplit, # dwindle
bind = $mainMod, I, pin, active
bind = $mainMod, U, exec, hyprctl setprop active opaque toggle
# bind = , Print, exec, grim -g "$(slurp)" - | wl-copy
bind = , Print, exec, caelestia screenshot --freeze --region
bind = ALT, Print, exec, grimblast --freeze --notify edit area
bind = $mainMod, Print, exec, grimblast --freeze --notify copysave area $(date + '%s_grim.png')
binde = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_SINK@ 3%+
binde = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_SINK@ 3%-
bind = $mainMod, O, exec, obsidian --enable-features=UseOzonePlatform --ozone-platform=x11
bind = $mainMod, F, exec, dex /usr/share/applications/vscodium-git-wayland.desktop

# Groups
# bind = $mainMod,Tab,hy3:movefocus,r,visible
# bind = $mainMod, T, hy3:changegroup, toggletab
# bind = $mainMod, G, hy3:makegroup, v
# bind = $mainMod, H, hy3:makegroup, h
# bind = $mainMod, J, hy3:changegroup, opposite
# bindn = , mouse:272, hy3:focustab, mouse

# Move focus
# bind = $mainMod, left, hy3:movefocus, l
# bind = $mainMod, right, hy3:movefocus, r
# bind = $mainMod, up, hy3:movefocus, u
# bind = $mainMod, down, hy3:movefocus, d

# Move window
# bind = $mainMod SHIFT, left, hy3:movewindow, l
# bind = $mainMod SHIFT, right, hy3:movewindow, r
# bind = $mainMod SHIFT, up, hy3:movewindow, u
# bind = $mainMod SHIFT, down, hy3:movewindow, d

#bind = $mainMod ALT, 1,hy3:movetoworkspace, 1,follow
#bind = $mainMod ALT, 2,hy3:moveovetoworkspace, 2,follow
#bind = $mainMod ALT, 3,hy3:moveovetoworkspace, 3,follow
#bind = $mainMod ALT, 4,hy3:moveovetoworkspace, 4,follow
#bind = $mainMod ALT, 5,hy3:moveovetoworkspace, 5,follow

# Switch workspaces with mainMod + [0-9]
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# WORKSPACES
# -- main
workspace = 1, name:initial, monitor:HDMI-A-2, border:false, rounding:false, decorate:false, persistent:true
workspace = 2, name:web, monitor:HDMI-A-2, default:true, persistent:true
workspace = special:scratchpad, monitor:HDMI-A-2, on-created-empty:kitty

# -- secondary
workspace = 3, name:social, monitor:DP-3, default:true, persistent:true
workspace = 4, name:notes, monitor:DP-3, on-created-empty:obsidian

# Move active window to a workspace with mainMod + SHIFT + [0-9]
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Example special workspace (scratchpad)
bind = $mainMod, S, togglespecialworkspace, scratchpad
bind = $mainMod SHIFT, S, movetoworkspace, special:scratchpad
bind = $mainMod, Q, exec, caelestia toggle communication
bind = $mainMod SHIFT, Q, movetoworkspace, special:communication
bind = $mainMod, M, exec, caelestia toggle sysmon
bind = $mainMod, D, exec, caelestia toggle todo

# Scroll through existing workspaces with mainMod + scroll
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1

# Move/resize windows with mainMod + LMB/RMB and dragging
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow
